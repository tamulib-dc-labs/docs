<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Using Karaf" href="using-karaf.html" /><link rel="prev" title="Understanding Solr Config in Fedora" href="fedora_solr.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Reindexing Solr - TAMU Digital Collections Labs documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">TAMU Digital Collections Labs  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">TAMU Digital Collections Labs  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Overview of Digital Library Program</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/01_current.html">Infrastructure, Software, and Systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/02_people.html">People and Departments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/05_projects.html">Projects</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Policies and Procedures</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../policies/captions_and_transcripts.html">Policy and Guiding Principles for Captioning and Transcription of A/V Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../policies/metadata.html">Metadata Guidelines for Digital Resources at Texas A&amp;M University Libraries</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Applications and Workflows</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../workflows/archipelago.html">Archipelago</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Archipelago</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../archipelago/indexing-hand-written-text.html">Associating HTR with Image Files</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../workflows/avalon.html">Avalon</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Avalon</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../avalon/api-batch-upload.html">Importing media into Avalon via API Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="../avalon/avalon_importing_entities.html">Importing media into Avalon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../avalon/avalon_template.html">Template for Avalon Batch Imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../avalon/downloading_from_avalon.html">Downloading media from Avalon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../avalon/generating_structures_from_csv.html">Generating Structures from CSV</a></li>
<li class="toctree-l2"><a class="reference internal" href="../avalon/metadata.html">Avalon Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../avalon/pdf-creation.html">How to make a PDF transcript to upload to Avalon.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../avalon/remediating-failed-imports.html">Remediating Failed Imports in Avalon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../avalon/troubleshooting.html">Troubleshooting Various Avalon Wonky-ness</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../workflows/dspace.html">DSPACE &amp; Oaktrust</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of DSPACE &amp; Oaktrust</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../dspace/dspace-entities.html">Understanding Our DSPACE Entities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dspace/dspace-importing-large-batches.html">Batch Importing SAFs Using the DSpace Command Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dspace/dspace_9_testing.html">Features and Tests for DSPACE 9</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dspace/dspace_entities.html">DSPACE Entity Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dspace/dspace_extending_embargos.html">DSPACE: Extending Embargos in DSpace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dspace/dspace_importing.html">DSPACE: Importing Basic Items</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dspace/dspace_importing_entities.html">DSPACE: Importing Entities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dspace/dspace_importing_entities_ojs.html">DSPACE: Importing Entities from OJS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dspace/oaktrust.html">OAKTrust and DSPACE Statistcs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dspace/rdfizing.html">RDFizing DSPACE Works to Generate Manifests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dspace/reporting_500_errors.html">Reporting 500 Errors</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../../workflows/fedora.html">Fedora</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Fedora</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="creating-iiif-manifests.html">Creating IIIF Collections and Manifests</a></li>
<li class="toctree-l2"><a class="reference internal" href="fedora_solr.html">Understanding Solr Config in Fedora</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Reindexing Solr</a></li>
<li class="toctree-l2"><a class="reference internal" href="using-karaf.html">Using Karaf</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../workflows/ojs.html">OJS</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of OJS</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../ojs/applying_for_issns.html">Applying for an ISSN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ojs/minting_dois_in_ojs.html">Minting DOIs in OJS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ojs/ojs_and_doi_metadata.html">OJS and DOI Metadata</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../workflows/open-oni.html">Open ONI</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Open ONI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../open-oni/batch-processing.html">How to Process a Batch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../open-oni/open-oni-problems.html">Solving Open Oni Issues</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../workflows/sage.html">SAGE</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of SAGE</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../sage/sage-import.html">Importing media into SAGE - WITHOUT Rancher</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sage/sage_import.html">SAGE Import</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../workflows/spotlight_import.html">Spotlight</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Spotlight</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../spotlight/browse-categories.html">Creating a Browse Category</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spotlight/creating-an-exhibit.html">Creating and Modifying Exhibits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spotlight/troubleshooting-write-issues.html">Troubleshooting Write Issues</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Services and Topics</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../other_services/accessibility.html">Accessibility</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Accessibility</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/accessibility/pdf_accessibility.html">PDF Accessibility</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../other_services/generating_service_files.html">Generating Service Files and Derivatives</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../other_services/identifiers.html">Identifiers</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Identifiers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/identifiers/doi-naming.html">Conventions for Structuring DOIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/identifiers/minting_a_doi.html">Minting DOIs in Crossref</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/identifiers/minting_arks.html">Minting ARKs with EZID</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../other_services/iiif.html">IIIF</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of IIIF</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/iiif/adding-thumbnails.html">Adding a Thumbnail to a IIIF Manifest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/iiif/finding_iiif.html">Finding IIIF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/iiif/fixing-broken-cache-from-ir-iiif-service.html">Fixing Broken Cache from IR IIIF Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/iiif/generating_iiif_collections.html">IIIF: Generating IIIF and IIIF Collections</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../other_services/kube.html">Kubernetes and Docker</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Kubernetes and Docker</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/kube-and-docker/kubectl.html">Configuring and Using Kubectl to Access PODs without a Browser</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/kube-and-docker/running_detached_processes_in_docker.html">Running Detached Processes in a Docker Container</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../other_services/open_education_materials_and_ip.html">Open Education Materials and IP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other_services/renaming_files_for_ts.html">Renaming Files from Preservation for Technology Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other_services/using_super_computer_for_gpu_needs.html">Using the Super Computer when we Need GPU</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../other_services/whisper.html">Whisper</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of Whisper</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/whisper/whisper-transcripts.html">Making Transcripts with Whisper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/whisper/whisper-transcripts-cleanup.html">Cleaning a Whisper Transcript</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../topics_and_services/whisper/whisperx-transcripts.html">Making Transcripts with WhisperX</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../other_services/writing_documentation.html">How to Write Documentation on this website</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Configurations and Mappings</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../config/cantaloupe_config.html">Cantloupe Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Crosswalking</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../crosswalking/avalon-to-pdf.html">Crosswalking: Avalon to PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crosswalking/creating-ark.html">Creating ARKs with TAMU ID Minter</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/applications/fedora/post-ingestion.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="reindexing-solr">
<h1>Reindexing Solr<a class="headerlink" href="#reindexing-solr" title="Link to this heading">¶</a></h1>
<section id="about">
<h2>About<a class="headerlink" href="#about" title="Link to this heading">¶</a></h2>
<p>Sometimes, Solr needs to be reindexed.  Depending on the health of the server this could be after MAGPIE ingests
something or when you need to reindex everything after changing ldpath.  This document attempts to explain those
processes.</p>
</section>
<section id="post-ingest">
<h2>Post Ingest<a class="headerlink" href="#post-ingest" title="Link to this heading">¶</a></h2>
<p>After MagPie runs, you may need to make Fedora index the documents in Solr.</p>
<p>Since we have moved to Rancher from Chef, Solr documents do not always get written automatically  to fcrepo’s Solr
instance. The same goes for the triple store. As a result, you must trigger it by shelling into fcrepo and posting
an HTTP request against the Fedora Reindexing Service.</p>
</section>
<section id="running">
<h2>Running<a class="headerlink" href="#running" title="Link to this heading">¶</a></h2>
<p>Connect to the <code class="code docutils literal notranslate"><span class="pre">fedora</span></code> pod or wherever fedora is running via shell.  You can do this in Rancher or via
kubectl.</p>
<p>Once inside the container (pod), you can get useful information about the service via cURL:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>http://localhost:9080/reindexing
</pre></div>
</div>
<p>To reindex, you need to make a POST to the defined re-indexing endpoint, and it will begin to traverse the Fedora
repository at that point, sending “re-indexing” hints to the specified services (there are no default services
defined). Currently, there is no way to target specific Fedora resources with this method.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:9080/reindexing/<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;[&quot;broker:queue:solr.reindex&quot;,&quot;broker:queue:triplestore.reindex&quot;]&#39;</span>
</pre></div>
</div>
<p>Note, running the command above should reindex Solr and Fuseki.  You can remove the Fuseki command if unneeded.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:9080/reindexing/<span class="w"> </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;[&quot;broker:queue:solr.reindex&quot;]&#39;</span>
</pre></div>
</div>
</section>
<section id="redeploying-and-removing-health-check">
<h2>Redeploying and Removing Health Check<a class="headerlink" href="#redeploying-and-removing-health-check" title="Link to this heading">¶</a></h2>
<p>Before you do this, you may need to remove the healthcheck and redeploy pods.</p>
<p>The settings for the healthcheck should look something like this:</p>
<img alt="An Image of the Health Check in Rancher" src="../../_images/health-check.png" />
<p>You can access this page from <code class="code docutils literal notranslate"><span class="pre">Workloads</span> <span class="pre">-&gt;</span> <span class="pre">Pod</span> <span class="pre">Name</span> <span class="pre">(fedora)</span> <span class="pre">-&gt;</span> <span class="pre">Config</span> <span class="pre">-&gt;</span> <span class="pre">Health</span> <span class="pre">Check</span></code></p>
</section>
<section id="monitoring">
<h2>Monitoring<a class="headerlink" href="#monitoring" title="Link to this heading">¶</a></h2>
<p>After running the reindex, you can then watch the logs to make sure every thing is running well like so:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># karaf log:</span>
tail<span class="w"> </span>-f<span class="w"> </span>/usr/local/karaf/data/log/karaf.log
ls<span class="w"> </span>-al<span class="w"> </span>/usr/local/karaf/data/log/
</pre></div>
</div>
<p>If nothing happens, you need to redploy or remove the health check.  I recommend first trying a redeploy of
<code class="code docutils literal notranslate"><span class="pre">fedora</span></code> and <code class="code docutils literal notranslate"><span class="pre">fedora-solr</span></code>.  If that doesn’t work, remove the health check.</p>
<p>It is still unclear exactly what needs to happen for this to work. We have also seen where adding the liveliness
check back seems to make things start working again.</p>
</section>
<section id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading">¶</a></h2>
<p>Here are the <code class="code docutils literal notranslate"><span class="pre">karaf.log`</span></code> contents for an item as it’s being indexed:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tomcat@fedora-596dfc5957-55c7j:/usr/local/karaf/data/log$<span class="w"> </span>grep<span class="w"> </span>-nri<span class="w"> </span><span class="s2">&quot;https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/28&quot;</span><span class="w"> </span>.
./karaf.log.1:12989:2025-07-01T18:15:15,660<span class="w"> </span><span class="p">|</span><span class="w"> </span>INFO<span class="w">  </span><span class="p">|</span><span class="w"> </span>qtp761343288-110<span class="w"> </span><span class="p">|</span><span class="w"> </span>LDCacheBackend<span class="w">                   </span><span class="p">|</span><span class="w"> </span><span class="m">160</span><span class="w"> </span>-<span class="w"> </span>org.fcrepo.camel.fcrepo-ldpath<span class="w"> </span>-<span class="w"> </span><span class="m">4</span>.7.2<span class="w"> </span><span class="p">|</span><span class="w"> </span>retrieving<span class="w"> </span>resource<span class="w"> </span>https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/28
./karaf.log.1:12990:2025-07-01T18:15:15,672<span class="w"> </span><span class="p">|</span><span class="w"> </span>INFO<span class="w">  </span><span class="p">|</span><span class="w"> </span>qtp761343288-110<span class="w"> </span><span class="p">|</span><span class="w"> </span>AbstractHttpProvider<span class="w">             </span><span class="p">|</span><span class="w"> </span><span class="m">166</span><span class="w"> </span>-<span class="w"> </span>wrap_file__usr_local_tomcat_.m2_repository_org_apache_marmotta_ldclient-core_3.3.0_ldclient-core-3.3.0.jar<span class="w"> </span>-<span class="w"> </span><span class="m">0</span>.0.0<span class="w"> </span><span class="p">|</span><span class="w"> </span>retrieving<span class="w"> </span>resource<span class="w"> </span>data<span class="w"> </span><span class="k">for</span><span class="w"> </span>https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/28<span class="w"> </span>from<span class="w"> </span><span class="s1">&#39;Linked Data&#39;</span><span class="w"> </span>endpoint,<span class="w"> </span>request<span class="w"> </span>URI<span class="w"> </span>is<span class="w"> </span>&lt;https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/28&gt;
./karaf.log.1:12991:2025-07-01T18:15:16,221<span class="w"> </span><span class="p">|</span><span class="w"> </span>INFO<span class="w">  </span><span class="p">|</span><span class="w"> </span>qtp761343288-110<span class="w"> </span><span class="p">|</span><span class="w"> </span>AbstractHttpProvider<span class="w">             </span><span class="p">|</span><span class="w"> </span><span class="m">166</span><span class="w"> </span>-<span class="w"> </span>wrap_file__usr_local_tomcat_.m2_repository_org_apache_marmotta_ldclient-core_3.3.0_ldclient-core-3.3.0.jar<span class="w"> </span>-<span class="w"> </span><span class="m">0</span>.0.0<span class="w"> </span><span class="p">|</span><span class="w"> </span>retrieved<span class="w"> </span><span class="m">58</span><span class="w"> </span>triples<span class="w"> </span><span class="k">for</span><span class="w"> </span>resource<span class="w"> </span>https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/28<span class="p">;</span><span class="w"> </span>expiry<span class="w"> </span>date:<span class="w"> </span>Wed<span class="w"> </span>Jul<span class="w"> </span><span class="m">02</span><span class="w"> </span><span class="m">18</span>:15:16<span class="w"> </span>UTC<span class="w"> </span><span class="m">2025</span>
./karaf.log.1:12992:2025-07-01T18:15:16,221<span class="w"> </span><span class="p">|</span><span class="w"> </span>INFO<span class="w">  </span><span class="p">|</span><span class="w"> </span>qtp761343288-110<span class="w"> </span><span class="p">|</span><span class="w"> </span>LDCache<span class="w">                          </span><span class="p">|</span><span class="w"> </span><span class="m">165</span><span class="w"> </span>-<span class="w"> </span>wrap_file__usr_local_tomcat_.m2_repository_org_apache_marmotta_ldcache-core_3.3.0_ldcache-core-3.3.0.jar<span class="w"> </span>-<span class="w"> </span><span class="m">0</span>.0.0<span class="w"> </span><span class="p">|</span><span class="w"> </span>refreshed<span class="w"> </span>resource<span class="w"> </span>https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/28
./karaf.log.1:13455:2025-07-01T18:15:58,742<span class="w"> </span><span class="p">|</span><span class="w"> </span>INFO<span class="w">  </span><span class="p">|</span><span class="w"> </span>qtp761343288-110<span class="w"> </span><span class="p">|</span><span class="w"> </span>LDCacheBackend<span class="w">                   </span><span class="p">|</span><span class="w"> </span><span class="m">160</span><span class="w"> </span>-<span class="w"> </span>org.fcrepo.camel.fcrepo-ldpath<span class="w"> </span>-<span class="w"> </span><span class="m">4</span>.7.2<span class="w"> </span><span class="p">|</span><span class="w"> </span>retrieving<span class="w"> </span>resource<span class="w"> </span>https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/28
./karaf.log.1:13631:2025-07-01T18:15:58,930<span class="w"> </span><span class="p">|</span><span class="w"> </span>INFO<span class="w">  </span><span class="p">|</span><span class="w"> </span>qtp761343288-110<span class="w"> </span><span class="p">|</span><span class="w"> </span>LDCacheBackend<span class="w">                   </span><span class="p">|</span><span class="w"> </span><span class="m">160</span><span class="w"> </span>-<span class="w"> </span>org.fcrepo.camel.fcrepo-ldpath<span class="w"> </span>-<span class="w"> </span><span class="m">4</span>.7.2<span class="w"> </span><span class="p">|</span><span class="w"> </span>retrieving<span class="w"> </span>resource<span class="w"> </span>https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/28
./karaf.log.4:44792:2025-07-01T19:02:39,336<span class="w"> </span><span class="p">|</span><span class="w"> </span>INFO<span class="w">  </span><span class="p">|</span><span class="w"> </span>qtp761343288-110<span class="w"> </span><span class="p">|</span><span class="w"> </span>LDCacheBackend<span class="w">                   </span><span class="p">|</span><span class="w"> </span><span class="m">160</span><span class="w"> </span>-<span class="w"> </span>org.fcrepo.camel.fcrepo-ldpath<span class="w"> </span>-<span class="w"> </span><span class="m">4</span>.7.2<span class="w"> </span><span class="p">|</span><span class="w"> </span>retrieving<span class="w"> </span>resource<span class="w"> </span>https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/28
./karaf.log.4:45021:2025-07-01T19:02:39,741<span class="w"> </span><span class="p">|</span><span class="w"> </span>INFO<span class="w">  </span><span class="p">|</span><span class="w"> </span>qtp761343288-110<span class="w"> </span><span class="p">|</span><span class="w"> </span>LDCacheBackend<span class="w">                   </span><span class="p">|</span><span class="w"> </span><span class="m">160</span><span class="w"> </span>-<span class="w"> </span>org.fcrepo.camel.fcrepo-ldpath<span class="w"> </span>-<span class="w"> </span><span class="m">4</span>.7.2<span class="w"> </span><span class="p">|</span><span class="w"> </span>retrieving<span class="w"> </span>resource<span class="w"> </span>https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/28
./karaf.log.4:45197:2025-07-01T19:02:39,894<span class="w"> </span><span class="p">|</span><span class="w"> </span>INFO<span class="w">  </span><span class="p">|</span><span class="w"> </span>qtp761343288-110<span class="w"> </span><span class="p">|</span><span class="w"> </span>LDCacheBackend<span class="w">                   </span><span class="p">|</span><span class="w"> </span><span class="m">160</span><span class="w"> </span>-<span class="w"> </span>org.fcrepo.camel.fcrepo-ldpath<span class="w"> </span>-<span class="w"> </span><span class="m">4</span>.7.2<span class="w"> </span><span class="p">|</span><span class="w"> </span>retrieving<span class="w"> </span>resource<span class="w"> </span>https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/28
</pre></div>
</div>
</section>
<section id="automatically-rekicking-solr">
<h2>Automatically Rekicking Solr<a class="headerlink" href="#automatically-rekicking-solr" title="Link to this heading">¶</a></h2>
<p>Often times, this process above is very prone to failure.  Assuming you have set up a kubectl connection to the cluster, you can automate restarting this service like so:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">time</span><span class="w"> </span><span class="kn">import</span> <span class="n">sleep</span>


<span class="c1"># set a default time to wait on the log</span>
<span class="n">timeout_seconds</span> <span class="o">=</span> <span class="mi">30</span>

<span class="c1"># set cluster name based on your local context</span>
<span class="n">cluser_name</span> <span class="o">=</span> <span class="s2">&quot;pre-cluster&quot;</span>

<span class="c1"># Configure logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> [</span><span class="si">%(levelname)s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s2">&quot;fedora_monitor.log&quot;</span><span class="p">),</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># message to make sure your kube context is for the cluster above (if you have several configured)</span>
<span class="n">switch_context</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;kubectl&quot;</span><span class="p">,</span>
    <span class="s2">&quot;config&quot;</span><span class="p">,</span>
    <span class="s2">&quot;use-context&quot;</span><span class="p">,</span>
    <span class="n">cluser_name</span>
<span class="p">]</span>

<span class="c1"># The message we will use to restart the pod (check pod name and namespace)</span>
<span class="n">redeploy</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;kubectl&quot;</span><span class="p">,</span> <span class="s2">&quot;rollout&quot;</span><span class="p">,</span> <span class="s2">&quot;restart&quot;</span><span class="p">,</span> <span class="s2">&quot;deployment/fedora&quot;</span><span class="p">,</span> <span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;fcrepo4&quot;</span>
<span class="p">]</span>

<span class="c1"># A Function to Find the Name of Our Current Pod (It changes on redeploy)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_pod_name</span><span class="p">():</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;kubectl get pods -n fcrepo4 --no-headers &quot;</span>
        <span class="s1">&#39;-o custom-columns=&quot;:metadata.name&quot; | grep &quot;^fedora-&quot; | head -n 1&#39;</span>
    <span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="c1"># Function to monitor log</span>
<span class="k">def</span><span class="w"> </span><span class="nf">stream_with_timeout</span><span class="p">(</span><span class="n">proc</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
    <span class="n">last_line_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">watchdog</span><span class="p">():</span>
        <span class="k">while</span> <span class="n">proc</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">last_line_time</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No new log lines in </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> seconds. Terminating.&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No new log lines in </span><span class="si">{</span><span class="n">timeout</span><span class="si">}</span><span class="s2"> seconds. Terminating.&quot;</span><span class="p">)</span>
                <span class="n">proc</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
                <span class="k">break</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">watcher</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">watchdog</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">watcher</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
        <span class="n">last_line_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># On start, switch to your cluster</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">switch_context</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Log the Cluster you have connected with</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Assume things are stopped and redeploy</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">redeploy</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Redeploying&quot;</span><span class="p">)</span>
        <span class="c1"># Wait for Pod to spin before you try to get its name</span>
        <span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="c1"># Find the name of the pod</span>
        <span class="n">pod_name</span> <span class="o">=</span> <span class="n">get_pod_name</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Target pod: </span><span class="si">{</span><span class="n">pod_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">TAIL_CMD</span> <span class="o">=</span> <span class="s2">&quot;tail --follow=name --retry /usr/local/karaf/data/log/karaf.log 2&gt;/dev/null&quot;</span>
        <span class="n">monitor</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;kubectl&quot;</span><span class="p">,</span> <span class="s2">&quot;exec&quot;</span><span class="p">,</span> <span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="n">pod_name</span><span class="p">,</span> <span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;fcrepo4&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sh&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="n">TAIL_CMD</span>
        <span class="p">]</span>
        <span class="c1"># Monitor the log and if it rotates keep watching.  If it really stops, start back at top and restart pod.</span>
        <span class="k">with</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">monitor</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">proc</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">stream_with_timeout</span><span class="p">(</span><span class="n">proc</span><span class="p">,</span> <span class="n">timeout_seconds</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Interrupted by user&quot;</span><span class="p">)</span>
                <span class="n">proc</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="refreshed-resource">
<h2>Refreshed Resource<a class="headerlink" href="#refreshed-resource" title="Link to this heading">¶</a></h2>
<p>2025-07-02T00:01:02,445 | INFO  | qtp544841243-111 | LDCache                          | 165 - wrap_file__usr_local_tomcat_.m2_repository_org_apache_marmotta_ldcache-core_3.3.0_ldcache-core-3.3.0.jar - 0.0.0 | refreshed resource <a class="reference external" href="https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/88/pages">https://api-pre.library.tamu.edu/fcrepo/rest/bb/97/f2/3e/bb97f23e-803a-4bd6-8406-06802623554c/cherokee-cant-reindex_objects/88/pages</a></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="using-karaf.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Using Karaf</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="fedora_solr.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Understanding Solr Config in Fedora</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Mark Baggett
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Reindexing Solr</a><ul>
<li><a class="reference internal" href="#about">About</a></li>
<li><a class="reference internal" href="#post-ingest">Post Ingest</a></li>
<li><a class="reference internal" href="#running">Running</a></li>
<li><a class="reference internal" href="#redeploying-and-removing-health-check">Redeploying and Removing Health Check</a></li>
<li><a class="reference internal" href="#monitoring">Monitoring</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li><a class="reference internal" href="#automatically-rekicking-solr">Automatically Rekicking Solr</a></li>
<li><a class="reference internal" href="#refreshed-resource">Refreshed Resource</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>